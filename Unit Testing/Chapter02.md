# 2장 단위테스트란 무엇인가?
## 단위테스트의 정의

단위테스트의 정의는 다음과 같다.

* 작은 코드 조각을 검증한다.
* 빠르게 수행된다.
* 격리된 방식으로 처리하는 자동화된 테스트이다.

## 작은 코드 조각이 얼마나 작아야하는가에 대한 견해 (단위란 무엇인가!?)

### 견해1. 단위를 나누는 기준은 격리된 코드조각의 단위 (한개의 클래스 혹은 함수) 가 되어야 한다.

클래스(혹은 함수) 단위로 테스트 하는것이 외부 요인으로부터 최대한 테스트를 격리할 수 있고,  
유닛테스트가 실패했을때 실패한 코드를 빠르게 찾을 수 있다는 장점이 있기 때문임.

이를 위해서는 SUT외에 모든 의존성은 테스트 대역으로 대체되어야함.

### 견해2. 단위를 나누는 기준은 코드를 수행하고자 하는 동작이 되어야 한다.

결국 중요한것은 코드의 동작을 테스트하는것이 중요하다는 견해.  
SUT에 필요한 공유 의존성 외의 다른 의존성도 포함하여 테스트한다.  

왜냐하면 코드의 개별적 기능을 테스트한다면 테스트가 무엇을 테스트하는지 알기 어려워지기 때문이다. 

공유 의존성만 테스트 대역으로 대체함.  

*책에서 견해1에 대해서는 런던파로 소개되며, 견해2에 대해서는 고전파로 소개된다.*. 

## 빠르게 수행되어야 한다라는 것은 크게 중요한것은 아니다. 하지만, 다른 정의와 관련이 있다.. (라고 생각됨)

적절한 시간안에 수행되면 된다는듯.  
하지만 이부분에 대해서는 의존성과도 어느정도 관련이 있어보임.  
외부 의존성이나 공유 의존성으로 인해 테스트가 지연되거나 느려지는것을 방지해야한다는 의미로 보아도 충분할것같다.  
ex> *데이터베이스 성능이슈로 단위테스트가 오래걸림.*. 
    데이터베이스와 같은 외부 프로세스 의존성은 내부 프로세스 메모리보다 당연히 느리다. 이와 같은 부분은 테스트 대역으로 대체하여 빠르게 만들 수 있다.

ex> *동일한 파일을 쓰는 단위 테스트가 있어 해당 테스트는 동시 실행이 불가함*. 
    파일 시스템의 경우도 외부 의존성에 해당한다. 단위 테스트가 동시에 실행이 불가하다면 이것은 빠르게 실행된다고 볼 수 없다. 외부 의존성을 테스트 대역으로 대체하여 단위 테스트를 동시에 수행하도록 만들어 빠르게 만들 수 있다.  

## 격리된 방식으로 처리하는 자동화된 테스트이다에도 두가지 견해가 존재한다.

### 견해1. 격리라는 것은 테스트하고자 하는 코드 베이스에 대한 격리를 말한다. 코드 격리를 위해 불변 객체 외의 의존성은 모두 테스트 대역으로 대체한다.

### 견해2. 격리라는것은 단위테스트 자체에 대한 격리를 말한다. 한 단위테스트가 다른 단위테스트에 영향을 주지 않아야한다.

결국 단위에 대한 정의가 격리하는 대상에 대한 기준을 만든것이라고 볼 수 있음.  

## 런던파 vs 고전파

### 런던파가 테스트를 작성하는 방법.
- 단일 클레스에 대헤서 테스트한다. (여러개가 안되는 것은 아니지만 런던파의 장점을 살리기 위한 지침인듯)
- 코드 자체를 격리한다고 볼 수 있다. (클래스 혹은 메서드 단위로)
- 코드 자체를 격리하기 위해서 불변 의존성 외에 모든 의존성은 테스트 대역으로 대체한다.

### 고전파가 테스트를 작성하는 방법.
- 단일 클래스단위 보단 여러개의 클래스가 사용되더라도 동작 단위에 테스트를 수행한다.
- 공유 의존성만 테스트 대역으로 대체한다.

### 런던파의 장점(이라고 주장되는 것들)
- 코드베이스의 고장난 부분을 알아차리기 쉽다.
    - 모든 의존성이 테스트 대역으로 대체되었기 때문에 테스트가 작동하지 않는다면 코드 베이스만 체크하면된다.
- 복잡한 객체 그래프를 갖고있더라도 *테스트 대역*을 통해 쉽게 테스트 가능하다.
    - 어떠한 형태의 의존성이 있더라도 테스트 대역을 사용하면 의존성에 대한 생각은 하지 않아도됨.
- 복잡한 의존성을 모두 제거하고 테스트 할 수 있기 때문에 단위에 대한 단위를 클래스 단위로 비교적 쉽게 나눌 수 있다.
    - 어떤 것을 어떻게 테스트 하는지 크게 고민하지 않고 클래스의 명세에 대해서만 테스트를 진행하면된다.

### 런던파의 장점에 대한 반론
- 코드베이스의 고장난 부분을 알아차리기 쉽다.
    - 고전파의 방법으로 하더라도 단위 테스트가 고장난 시점에서 코드의 변경점을 확인해본다면 충분히 쉽게 확인 가능함.
- 복잡한 객체 그래프를 갖고있더라도 *테스트 대역*을 통해 쉽게 테스트 가능하다.
    - 1장의 내용처럼 테스트 대역을 사용하지 않고 테스트가 불가하다면 다시 설계해야함. 핀트가 어긋난 주장임.
- 복잡한 의존성을 모두 제거하고 테스트 할 수 있기 때문에 단위에 대한 단위를 클래스 단위로 비교적 쉽게 나눌 수 있다.
    - 클래스 단위로 나눠서 테스트 하는것은 제법 쉬운 단위라고 생각되지만 결국 무엇을 테스트 하는지 알 수 없게될 뿐더러 테스트가 코드 베이스와 너무 긴밀하게 결합된다.
        - 클래스에 기능하나 수정되면 테스트를 바로 수정해야하는 케이스를 말하는것으로 생각됨.

## 개인적인 정리
- 단위 테스트의 단위는 동작의 단위를 의미하는것. 코드개별의 단위로 착각하지 않도록 한다.
    - 1장의 내용인 테스트의 목적을 상기해본다면 맞는 말임.
    - 중요한 코드 베이스에 대해서 투자해야하며, 최소한의 유지비로 최대의 가치를 끌어내자.
    - 하지만 런던파처럼 코드 단위에 대해서 테스트하게 된다면 무엇이 중요한지 알 수 없게 되고(코드에서 중요한건 동작이지 개별 클래스가 아니므로..), 결과 최소한의 유지비용으로 최대의 가치를 끌어 낸다는 것이 힘들어지게될듯.
- 결국 설계 문제라는 것.. 고전파의 방식으로 동작에 테스트가 안된다면 설계부터 다시해야...
    - 이것도 지난날 코드를 설계해 온것을 생각해보면 맞는 말임.
    - 클래스 설계가 잘된 모듈은 공유 의존성 외에는 테스트 대역을 사용하지 않아도 동작에 대한 테스트를 하는것에 문제가 없었다.
- 단위를 나누는 기준이 런던파와 고전파가 있다는것은 실제로 존재하는 것인지는 모르겠으나, 개인적인 경험으로 볼때 런던파의 방식으로 테스트하게 되는 경위는 다음과 같았음.
    - 단위테스트를 하고자하면 무엇을 테스트 해야할지 모르게되는 경우가 많음.
    - 단위테스트 프레임워크의 사용법을 보고 무엇을 테스트할지 모르는 상태에서 가장 쉽게 떠올릴 수 있는 것이 단위라는 단어에 착각해 동작하는 최소단위인 클래스를 테스트하고자 마음먹게됨.
    - 하지만 잘못된 설계에서는 클래스하나에 대해서 테스트 하는것이 실제로 불가능함.
    - 해당 테스트가 변경불가능한 너무 많은 의존성을 갖고있기 때문임.
    - 따라서 해당 의존성을 모두 테스트 대역으로 바꿈. 여기서는 보통 목을 사용하게됨.
    - 런던파 테스트 완성
- 통합테스트와 엔드투 엔드 테스트가 소개되었지만, 이번장에서는 크게 중요한 내용은 없었다.


## Appendix
- 테스트 대역
  - 아무튼 의존성을 대체하는 무언가. (목이 될수도 있고 뭐가될수도있고..)

- 공유 의존성
  - 테스트간에 영향을 미칠 수 있는 의존성을 말함.
  - static mutable field, 데이터베이스 등 이 공의 의존성에 해당할 수 있음.

- 비공개 의존성
  - 공유하지 않는 의존성
  - 테스트간에 영향을 주지 않음.

- 프로세스 외부 의존성
  - 외부에서 실행되는 의존성을 말함.
  - 아직 메모리에 없는 데이터에 대한 프록시.
  - 파일 시스템, 데이터베이스 등이 해당한다고 보면된다.

- 불변 의존성
  - 값객체나 값.
  - 내용에 의해서만 식별됨.

- SUT (System Under Test)
  - 테스트의 대상이 되는 시스템
    - 런던파로 치면 클래스
    - 고전파로 치면 동작단위
